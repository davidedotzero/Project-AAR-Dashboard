# T13: พัฒนาฟีเจอร์แจ้งเตือนการอัปเดต Task บน Navbar

## 1. เป้าหมาย (Goal)

เพื่อลดโอกาสที่งานจะตกหล่นและเพิ่มการรับรู้ (Awareness) เกี่ยวกับ Task ที่ได้รับมอบหมาย โดยเฉพาะวันกำหนดส่ง (Deadline) ระบบจะแสดงการแจ้งเตือนที่เข้าถึงง่ายบน Navbar เพื่อให้ Owner หรือทีมผู้รับผิดชอบสามารถวางแผนการทำงานได้ล่วงหน้า และหลีกเลี่ยงการทำงานเร่งด่วนก่อนถึงกำหนดส่ง

## 2. คุณสมบัติหลัก (Key Features)

1.  **ไอคอนแจ้งเตือนบน Navbar:**
    * มีไอคอนรูปกระดิ่ง (Bell) หรือสัญลักษณ์ที่สื่อถึงการแจ้งเตือนปรากฏอยู่บน Navbar
    * (Optional) แสดง Badge ตัวเลขจำนวนการแจ้งเตือนที่ยังไม่ได้อ่าน

2.  **Dropdown แสดงรายการแจ้งเตือน:**
    * เมื่อผู้ใช้คลิกที่ไอคอนแจ้งเตือน จะมี Dropdown แสดงรายการแจ้งเตือนล่าสุด
    * คลิกที่ไอคอนอีกครั้งหรือคลิกนอกพื้นที่ Dropdown เพื่อปิด

3.  **เนื้อหาในการ์ดแจ้งเตือน (Notification Card):**
    * แต่ละรายการในการแจ้งเตือนจะแสดงข้อมูลสำคัญของ Task อย่างชัดเจน:
        * **Task คืออะไร:** ชื่อ Task
        * **จากโปรเจกต์ไหน:** ชื่อ Project
        * **เวลาที่สร้าง:** วัน/เวลาที่ Task ถูกสร้างหรือได้รับมอบหมาย
        * **เวลาที่ Deadline:** วัน/เวลาที่ต้องส่งมอบงาน

## 3. ขั้นตอนการดำเนินงาน (Implementation Steps)

### 3.1. ฝั่ง Backend (Google Apps Script - `API.gs`)
## แก้ไข : ไฟล์ `gas/API.js` ไฟล์นี้จะเป็นไฟล์ mockup เพื่อคัดลอก ไปวางใน Google App Script 

* [ ] **สร้าง API Endpoint สำหรับดึงข้อมูลการแจ้งเตือน:**
    * สร้างฟังก์ชันใหม่ `getNotifications_API(user)`
    * Logic ของฟังก์ชันนี้ควรดึง Task ที่เกี่ยวข้องกับ `user` ที่ล็อกอินอยู่ โดยอาจมีเงื่อนไขเช่น:
        * Task ที่ถูกสร้างใหม่ภายใน 7 วันล่าสุด
        * Task ที่มี Deadline ใกล้จะถึงในอีก 7 วันข้างหน้า
        * (พิจารณา Performance) อาจจำกัดการดึงข้อมูลไม่เกิน 20 รายการล่าสุด
    * Response ที่ส่งกลับมาควรเป็น Array ของ Object ที่มีข้อมูลครบถ้วนตามที่ระบุในคุณสมบัติหลัก

* [ ] **(Optional) สร้าง API สำหรับจัดการสถานะ "อ่านแล้ว":**
    * สร้างชีต `Notifications` ใหม่เพื่อเก็บสถานะ `isRead`
    * ระบุว่าภายในชีท ประกอบไปด้วย `Notifications` หัวคอลัมน์อะไรบ้าง และประเภทข้อมูลอะไรบ้าง 
    * สร้างฟังก์ชัน `markNotificationsAsRead_API(user, notificationIds)` เพื่ออัปเดตสถานะเมื่อผู้ใช้เปิดดู

* [ ] **(Testing) เขียนเทส สำหรับการทำงาน ฝั่ง Backend:**
    * จำลองการทำงาน บน Google App Sciprt , Google Sheet ว่าสามารถ สร้าง Noti ได้ไหม
    

### 3.2. ฝั่ง Frontend (React)

* [ ] **สร้าง UI Components:**
    * **`NotificationBell.tsx`:** Component สำหรับไอคอนบน Navbar ที่จะแสดง Badge และจัดการ state การเปิด/ปิด Dropdown
    * **`NotificationDropdown.tsx`:** Component ที่เป็นกล่อง Dropdown ซึ่งจะทำการ `.map()` ข้อมูลการแจ้งเตือนเพื่อแสดงผล
    * **`NotificationItem.tsx`:** Component สำหรับการ์ดแจ้งเตือนแต่ละใบ ที่จะแสดงผล Task, Project, Creation Time, และ Deadline

* [ ] **การจัดการ State และ Data Fetching:**
    * ใน `DataContext` หรือสร้าง `NotificationContext` ใหม่ เพื่อจัดการ State ของการแจ้งเตือน (notifications, unreadCount)
    * สร้างฟังก์ชันสำหรับเรียกใช้ `getNotifications_API` เมื่อโหลดแอปพลิเคชัน หรือมีการทำงานที่สำคัญเกิดขึ้น
    * (Optional) อาจมีการตั้งเวลา (Polling) เพื่อดึงข้อมูลการแจ้งเตือนใหม่ๆ ทุกๆ 5-10 นาที

* [ ] **เชื่อมโยง Logic:**
    * นำ `NotificationBell` ไปวางใน Component Navbar หลัก
    * เชื่อม Logic การคลิกเพื่อเปิด/ปิด `NotificationDropdown`
    * (Optional) เมื่อผู้ใช้เปิด Dropdown ให้เรียก API `markNotificationsAsRead_API` เพื่ออัปเดตสถานะ

## 4. เกณฑ์การยอมรับ (Acceptance Criteria)

-   [ ] มีไอคอนแจ้งเตือนแสดงผลบน Navbar
-   [ ] เมื่อคลิกที่ไอคอน สามารถเปิดและปิด Dropdown ที่แสดงรายการแจ้งเตือนได้
-   [ ] ในแต่ละรายการแจ้งเตือน ต้องแสดงข้อมูล "ชื่อ Task", "ชื่อ Project", "เวลาสร้าง", และ "Deadline" อย่างถูกต้อง
-   [ ] ระบบจะต้องแสดงการแจ้งเตือนสำหรับ Task ที่เกี่ยวข้องกับผู้ใช้ที่ล็อกอินอยู่เท่านั้น